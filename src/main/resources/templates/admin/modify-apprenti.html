<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Modifier un apprenti</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="../../../images/favicon.ico" />
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../../../css/bootstrap.min.css">
    <!-- Typography CSS -->
    <link rel="stylesheet" href="../../../css/typography.css">
    <!-- Style CSS -->
    <link rel="stylesheet" href="../../../css/style.css">
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="../../../css/responsive.css">

    <link rel="stylesheet" href="../../../css/dialog.css">


</head>
<body>
<!-- loader Start -->
<div id="loading">
    <div id="loading-center">
        <div class="loader">
            <div class="cube">
                <div class="sides">
                    <div class="top"></div>
                    <div class="right"></div>
                    <div class="bottom"></div>
                    <div class="left"></div>
                    <div class="front"></div>
                    <div class="back"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- loader END -->
<!-- Wrapper Start -->
<div class="wrapper">
    <!-- Sidebar  -->
    <div class="iq-sidebar">
        <div class="iq-sidebar-logo d-flex justify-content-between">
            <a href="#">
                <img src="images/logo.png" class="img-fluid" alt="">
                <span>CA</span>
            </a>
            <div class="iq-menu-bt align-self-center">
                <div class="wrapper-menu">
                    <div class="line-menu half start"></div>
                    <div class="line-menu"></div>
                    <div class="line-menu half end"></div>
                </div>
            </div>
        </div>
        <div id="sidebar-scrollbar">
            <nav class="iq-sidebar-menu">
                <ul id="iq-sidebar-toggle" class="iq-menu">
                    <li class="iq-menu-title"><i class="ri-separator"></i><span>Acceuil</span></li>
                    <li><a href="../../../admin" class="iq-waves-effect"><i class="ri-chat-check-line"></i><span>Page d'acceuil</span></a></li>

                    <li class="iq-menu-title"><i class="ri-separator"></i><span>Créer</span></li>
                    <li><a href="../../../admin/add-user/apprenti" class="iq-waves-effect"><i class="ri-chat-check-line"></i><span>Ajouter apprenti</span></a></li>
                    <li><a href="../../../admin/add-entreprise" class="iq-waves-effect"><i class="ri-chat-check-line"></i><span>Ajouter entreprise</span></a></li>
                    <li><a href="../../../admin/add-user/tuteur-insa" class="iq-waves-effect"><i class="ri-chat-check-line"></i><span>Ajouter tuteur INSA</span></a></li>
                    <li><a href="../../../admin/add-user/tuteur-entreprise" class="iq-waves-effect"><i class="ri-chat-check-line"></i><span>Ajouter tuteur entreprise</span></a></li>
                    <li class="iq-menu-title"><i class="ri-separator"></i><span>Listes</span></li>
                    <li><a href="../../../admin/list-apprentis" class="iq-waves-effect"><i class="ri-chat-check-line"></i><span>Liste des apprentis</span></a></li>
                    <li><a href="../../../admin/list-tuteurs-insa" class="iq-waves-effect"><i class=" ri-chat-check-line"></i><span>Liste des tuteurs INSA</span></a></li>
                    <li><a href="../../../admin/list-tuteurs-entreprise" class="iq-waves-effect"><i class="ri-chat-check-line"></i><span>Liste des tuteurs entreprise</span></a></li>

                    <li class="iq-menu-title"><i class="ri-separator"></i><span>Connexion</span></li>
                    <li>
                        <a href="#authentication" class="iq-waves-effect collapsed"  data-toggle="collapse" aria-expanded="false"><i class="ri-pages-line"></i><span>Authentication</span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul id="authentication" class="iq-submenu collapse" data-parent="#iq-sidebar-toggle">
                            <li><a href="../logout">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
            <div class="p-3"></div>
        </div>
    </div>
    <!-- TOP Nav Bar -->
    <div class="iq-top-navbar">
        <div class="iq-navbar-custom">
            <div class="iq-sidebar-logo">
                <div class="top-logo">
                    <a href="#" class="logo">
                        <img src="images/logo.png" class="img-fluid" alt="">
                        <span>INS'APPRENTI</span>
                    </a>
                </div>
            </div>
            <div class="navbar-breadcrumb">
                <h5 class="mb-0">Modifier un apprenti</h5>
                <nav aria-label="breadcrumb">
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Modifier un apprenti</li>
                    </ul>
                </nav>
            </div>
            <nav class="navbar navbar-expand-lg navbar-light p-0">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="ri-menu-3-line"></i>
                </button>
                <div class="iq-menu-bt align-self-center">
                    <div class="wrapper-menu">
                        <div class="line-menu half start"></div>
                        <div class="line-menu"></div>
                        <div class="line-menu half end"></div>
                    </div>
                </div>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ml-auto navbar-list">
                    </ul>
                </div>
                <ul class="navbar-list">
                    <li>
                        <a href="/admin" class="iq-waves-effect bg-primary text-white">ADMIN</a>
                        <div class="iq-sub-dropdown iq-user-dropdown">
                            <div class="iq-card shadow-none m-0">
                                <div class="iq-card-body p-0 ">
                                    <div class="bg-primary p-3">
                                    </div>


                                    <div class="d-inline-block w-100 text-center p-3">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <!-- TOP Nav Bar END -->
    <!-- Page Content  -->
    <div id="content-page" class="content-page">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-3">
                    <div class="iq-card">
                        <div class="iq-card-header d-flex justify-content-between">
                            <div class="iq-header-title">
                                <h4 class="card-title">Modifier un apprenti</h4>
                            </div>
                        </div>
                        <div class="iq-card-body">
                            <form>
                                <div class="form-group">
                                    <div class="add-img-user profile-img-edit">
                                        <img class="profile-pic img-fluid" src="images/user/11.png" alt="profile-pic">
                                        <div class="p-image">
                                            <!-- <h5 class="upload-button">file upload</h5> -->
                                            <a href="javascript:void();" class="upload-button btn iq-bg-primary">File Upload</a>
                                            <input class="file-upload" type="file" accept="image/*">
                                        </div>
                                    </div>
                                    <div class="img-extension mt-3">
                                        <div class="d-inline-block align-items-center">
                                            <span>Only</span>
                                            <a href="javascript:void();">.jpg</a>
                                            <a href="javascript:void();">.png</a>
                                            <a href="javascript:void();">.jpeg</a>
                                            <span>allowed</span>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="iq-card">
                        <div class="iq-card-header d-flex justify-content-between">
                            <div class="iq-header-title">
                                <h4 class="card-title">Informations</h4>
                            </div>
                        </div>
                        <div class="iq-card-body">
                            <div class="new-user-info">
                                <form>
                                    <div class="row">
                                        <div class="form-group col-md-6">
                                            <label for="prenom">Prénom:</label>
                                            <input th:value="${apprenti.prenom}" type="text" class="form-control" id="prenom" placeholder="Prénom">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="nom">Nom:</label>
                                            <input th:value="${apprenti.nom}" type="text" class="form-control" id="nom" placeholder="Nom">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="filliere">Filière:</label>
                                            <input th:value="${apprenti.filliere}" type="text" class="form-control" id="filiere" placeholder="STI, MRI, ...">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="promo">Promo:</label>
                                            <input th:value="${apprenti.promo}" type="text" class="form-control" id="promo" placeholder="202x">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="matricule">Matricule:</label>
                                            <input th:value="${apprenti.matricule}" type="text" class="form-control" id="matricule" placeholder="EE12345">
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="niveau">Niveau:</label>
                                            <input th:value="${apprenti.niveau}" type="text" class="form-control" id="niveau" placeholder="3ème année">
                                        </div>
                                        <div class="form-group col-sm-12">
                                            <label for="searchName">Nom de l'entreprise:</label>
                                            <div class="dropdown">
                                                <div id="myDropdown" class="dropdown-content">
                                                    <input style="margin-bottom: 5px;" class="form-control" type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()">
                                                    <div class="scrollable-dropdown">
                                                        <select class="dropdown-content" size="5" style="width: calc(100% - 2px);" id="selectNames" onchange="updateSearchBar(this)">
                                                            <option th:if="${apprenti.entreprise != null}" th:each="entreprise : ${entreprises}" th:value="${entreprise}" th:text="${entreprise.nom}"
                                                            th:selected ="(${ entreprise} == ${apprenti.entreprise  }) ? true : false"></option>
                                                            <option th:unless="${apprenti.entreprise == null}" th:each="entreprise : ${entreprises}" th:value="${entreprise}" th:text="${entreprise.nom}"></option>

                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <span>Vous n'avez pas trouvé l'entreprise ? <a href="/admin/add-entreprise">Créer une entreprise.</a></span>
                                        </div>


                                    </div>
                                    <hr>
                                    <h5 class="mb-3">Sécurité</h5>
                                    <div class="row">
                                        <div class="form-group col-md-12">
                                            <label for="email">Email:</label>
                                            <input th:value="${apprenti.email}" type="email" class="form-control" id="email" placeholder="utilisateur@exemple.com">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="mdp">Mot de passe:</label>
                                            <div class="input-group">
                                                <input class="form-control" type="text" id="mdp" name="mdp">
                                                <div class="input-group-append">
                                                    <button onclick="generateMdp(event)" class="btn btn-secondary">Générer</button>
                                                </div>
                                            </div>
                                        </div>


                                    </div>

                                    <hr>
                                    <h5 class="mb-3">Tuteurs</h5>
                                    <div class="row">
                                        <div th:if="${apprenti.tuteurInsa != null}" class="form-group col-md-6"  >
                                            INSA :
                                            <div>
                                                <span th:text="${apprenti.tuteurInsa.nom}"></span>
                                            </div>
                                            <button class="btn btn-danger" id="tuteur0" th:attr="onclick='removeTuteurAssign(\'' + ${apprenti.id} + '\', 0)'">Supprimer</button>

                                        </div>

                                        <div th:if="${apprenti.tuteurInsa == null}" class="form-group col-md-6" id="myDropdownInsa" >
                                            INSA :
                                            <div style="width: 100%">
                                                <input style="width: 100%" type="text" placeholder="Search.." id="myInputInsa" onkeyup="filterFunctionInsa()">
                                            </div>
                                            <select size="5" style="width: 100%" id="selectNamesInsa" th:attr="onchange='updateSearchBarInsa(this,\'' + ${apprenti.id} + '\')'">
                                                <option th:each="tuteurInsa : ${tuteursInsa}" th:value="${tuteurInsa.id}" th:text="${tuteurInsa.nom}"></option>
                                            </select>
                                        </div>

                                        <div th:if="${apprenti.tuteurEntreprise != null}" class="form-group col-md-6"  >
                                            Entreprise :
                                            <div>
                                                <span th:text="${apprenti.tuteurEntreprise.nom}"></span>
                                            </div>
                                            <button class="btn btn-danger" id="tuteur1" th:attr="onclick='removeTuteurAssign(\'' + ${apprenti.id} + '\', 1)'">Supprimer</button>

                                        </div>

                                            <div th:if="${apprenti.tuteurEntreprise == null}"  class="form-group col-md-6" id="myDropdownEntreprise" >
                                                Entreprise:
                                                <div style="width: 100%">
                                                    <input style="width: 100%" type="text" placeholder="Search.." id="myInputEntreprise" onkeyup="filterFunctionEntreprise()">
                                                </div>
                                                <select size="5" style="width: 100%"  id="selectNamesEntreprise" th:attr="onchange='updateSearchBarEntreprise(this,\'' + ${apprenti.id} + '\')'">
                                                    <option th:each="tuteurEntreprise : ${tuteursEntreprise}" th:value="${tuteurEntreprise.id}" th:text="${tuteurEntreprise.nom}"></option>
                                                </select>
                                                <span>Vous n'avez pas trouvé le tuteur ? <a href="#" onclick="window.dialog.showModal();">Créer un compte tuteur est l'assigner à l'apprenti.</a></span>
                                            </div>





                                    </div>
                                    <button id="modify-user" class="btn btn-primary">Modifier un apprenti</button>
                                    <div id="error-field"></div>
                                </form>


                                <dialog id="dialog">
                                    <div class="iq-card-body">
                                        <div class="new-user-info">
                                            <form>
                                                <div class="row">
                                                    <div class="form-group col-md-6">
                                                        <label for="prenom2">Prénom:</label>
                                                        <input type="text" class="form-control" id="prenom2" placeholder="Prénom">
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="nom2">Nom:</label>
                                                        <input type="text" class="form-control" id="nom2" placeholder="Nom">
                                                    </div>

                                                    <div class="form-group col-md-12">
                                                        <label for="post">Poste:</label>
                                                        <input class="form-control" type="text" id="post" name="post" placeholder="Tech Lead">
                                                    </div>


                                                </div>
                                                <hr>
                                                <h5 class="mb-3">Security</h5>
                                                <div class="row">
                                                    <div class="form-group col-md-12">
                                                        <label for="email2">Email:</label>
                                                        <input type="email" class="form-control" id="email2" placeholder="utilisateur@exemple.com">
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="mdp2">Mot de passe:</label>
                                                        <div class="input-group">
                                                            <input class="form-control" type="text" id="mdp2" name="mdp">
                                                            <div class="input-group-append">
                                                                <button onclick="generateMdp2(event)" class="btn btn-secondary">Générer</button>
                                                            </div>
                                                        </div>
                                                    </div>


                                                </div>
                                                <button type="submit" id="create-user" class="btn btn-primary">Ajouter tuteur</button>
                                                <div id="error-field2"></div>
                                            </form>
                                        </div>
                                    </div>

                                    <button onclick="window.dialog.close();" aria-label="close" class="x">❌</button>
                                </dialog>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Wrapper END -->
<!-- Footer -->
<footer class="bg-white iq-footer">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-6">
                <ul class="list-inline mb-0">
                    <li class="list-inline-item"><a href="privacy-policy.html">Privacy Policy</a></li>
                    <li class="list-inline-item"><a href="terms-of-service.html">Terms of Use</a></li>
                </ul>
            </div>
            <div class="col-lg-6 text-right">
                Copyright 2020 <a href="#">INS'APPRENTI</a> All Rights Reserved.
            </div>
        </div>
    </div>
</footer>
<!-- Footer END -->
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="../../../js/admin/modify-apprenti.js"></script>
<script src="../../../js/design/jquery.min.js"></script>
<script src="../../../js/design/popper.min.js"></script>
<script src="../../../js/design/bootstrap.min.js"></script>
<!-- Appear JavaScript -->
<script src="../../../js/design/jquery.appear.js"></script>
<!-- Countdown JavaScript -->
<script src="../../../js/design/countdown.min.js"></script>
<!-- Counterup JavaScript -->
<script src="../../../js/design/waypoints.min.js"></script>
<script src="../../../js/design/jquery.counterup.min.js"></script>
<!-- Wow JavaScript -->
<script src="../../../js/design/wow.min.js"></script>
<!-- Apexcharts JavaScript -->
<script src="../../../js/design/apexcharts.js"></script>
<!-- Slick JavaScript -->
<script src="../../../js/design/slick.min.js"></script>
<!-- Select2 JavaScript -->
<script src="../../../js/design/select2.min.js"></script>
<!-- Owl Carousel JavaScript -->
<script src="../../../js/design/owl.carousel.min.js"></script>
<!-- Magnific Popup JavaScript -->
<script src="../../../js/design/jquery.magnific-popup.min.js"></script>
<!-- Smooth Scrollbar JavaScript -->
<script src="../../../js/design/smooth-scrollbar.js"></script>
<!-- lottie JavaScript -->
<script src="../../../js/design/lottie.js"></script>
<!-- Chart Custom JavaScript -->
<script src="../../../js/design/chart-custom.js"></script>
<!-- Custom JavaScript -->
<script src="../../../js/design/custom.js"></script>
<script>
    async function removeTuteurAssign(userId, type){
        const res = await fetch(
            `/admin/removeTuteur/${userId}/${type}`,
            {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
            }
        );
        const data = await res.json();
        if(data.success){
            location.reload();
        }
        else{
            alert("Une erreur est survenue !")
        }
    }
    if(document.getElementById('tuteur0'))
    document.getElementById('tuteur0').addEventListener('click', (e) =>{
        e.preventDefault();
        const url = window.location.href.split('/');
        const id = url[url.length - 1];
        removeTuteurAssign(id, 0);
    });
    if(document.getElementById('tuteur1'))
    document.getElementById('tuteur1').addEventListener('click', (e) =>{
        e.preventDefault();
        const url = window.location.href.split('/');
        const id = url[url.length - 1];
        removeTuteurAssign(id, 1);
    });
</script>

<script type="text/javascript" th:src="@{../../../js/admin/modify-apprenti.js}"></script>
<script src="../../../js/admin/modify-user.js"></script>
<script src="../../../js/admin/add-tuteur-entreprise-dialog.js"></script>

</body>
</html>
